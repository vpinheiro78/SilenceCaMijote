// assistant.js

// Langue h√©rit√©e automatiquement depuis index.html
let currentLang = localStorage.getItem('siteLang') || 'fr';

// üî• Textes multilingues
const texts = {
  fr: {
    title: "üë®‚Äçüç≥ Votre Chef Virtuel",
    subtitle: "Je suis l√† pour imaginer avec vous des recettes uniques et personnalis√©es. Entrez dans l‚Äôunivers gourmand 2.0 o√π vous √™tes l‚Äôacteur ! ‚ú®",
    greeting: "Bonjour üëã, je suis Hugo, votre Chef Virtuel ! Comment puis-je vous r√©galer aujourd‚Äôhui ? üòã",
    options: [
      "üçÖ Cr√©er une recette avec mes ingr√©dients",
      "üç∞ Cr√©er une recette selon mes envies",
      "üéÅ Surprenez-moi avec une recette de saison"
    ],
    askIngredients: "Dites-moi les ingr√©dients principaux ü•ïüçóüç´ :",
    askType: "Vous avez envie d‚Äôun dessert üç∞ ou d‚Äôun plat üçΩÔ∏è ?",
    askCustom: "Super ! D√©crivez-moi votre envie (ex: tarte aux pommes, curry √©pic√©‚Ä¶) :",
    askPeople: "Pour combien de personnes devons-nous pr√©voir ce d√©lice ? üë®‚Äçüë©‚Äçüëß‚Äçüë¶",
    askDessert: "Parfait üòç ! Quel est l‚Äôingr√©dient vedette (chocolat, fruit‚Ä¶) ?",
    askPlat: "Super ! Vous pr√©f√©rez √† base de viande ü•© ou de poisson üêü ?",
    surprise: "‚ú® Ta-daa ! Voici une id√©e de saison rien que pour vous‚Ä¶",
    dessertBtn: "üç∞ Dessert",
    platBtn: "üçΩÔ∏è Plat",
    sendBtn: "Envoyer"
  },
  en: {
    title: "üë®‚Äçüç≥ Your Virtual Chef",
    subtitle: "I‚Äôm here to imagine unique and personalized recipes with you. Step into the gourmet 2.0 universe where YOU are the star! ‚ú®",
    greeting: "Hello üëã, I‚Äôm Hugo, your Virtual Chef! How can I delight you today? üòã",
    options: [
      "üçÖ Create a recipe with my ingredients",
      "üç∞ Create a recipe based on my cravings",
      "üéÅ Surprise me with a seasonal recipe"
    ],
    askIngredients: "Tell me your main ingredients ü•ïüçóüç´ :",
    askType: "Do you feel like a dessert üç∞ or a main dish üçΩÔ∏è?",
    askCustom: "Great! Describe your craving (e.g. apple pie, spicy curry‚Ä¶):",
    askPeople: "For how many people should I prepare this delight? üë®‚Äçüë©‚Äçüëß‚Äçüë¶",
    askDessert: "Perfect üòç! What‚Äôs the star ingredient (chocolate, fruit‚Ä¶)?",
    askPlat: "Great! Do you prefer meat ü•© or fish üêü?",
    surprise: "‚ú® Voil√†! A seasonal recipe just for you‚Ä¶",
    dessertBtn: "üç∞ Dessert",
    platBtn: "üçΩÔ∏è Main Dish",
    sendBtn: "Send"
  },
  es: {
    title: "üë®‚Äçüç≥ Tu Chef Virtual",
    subtitle: "Estoy aqu√≠ para imaginar contigo recetas √∫nicas y personalizadas. ¬°Entra en el universo gourmet 2.0 donde t√∫ eres el protagonista! ‚ú®",
    greeting: "Hola üëã, soy Hugo, tu Chef Virtual. ¬øC√≥mo puedo deleitarte hoy? üòã",
    options: [
      "üçÖ Crear una receta con mis ingredientes",
      "üç∞ Crear una receta seg√∫n mis antojos",
      "üéÅ Sorpr√©ndeme con una receta de temporada"
    ],
    askIngredients: "Dime los ingredientes principales ü•ïüçóüç´ :",
    askType: "¬øQuieres un postre üç∞ o un plato üçΩÔ∏è?",
    askCustom: "¬°Genial! Describe tu antojo (ej: tarta de manzana, curry picante‚Ä¶):",
    askPeople: "¬øPara cu√°ntas personas debo preparar esta delicia? üë®‚Äçüë©‚Äçüëß‚Äçüë¶",
    askDessert: "¬°Perfecto üòç! ¬øCu√°l es el ingrediente estrella (chocolate, fruta‚Ä¶)?",
    askPlat: "¬°Genial! ¬øPrefieres carne ü•© o pescado üêü?",
    surprise: "‚ú® ¬°Tach√°n! Aqu√≠ tienes una idea de temporada solo para ti‚Ä¶",
    dessertBtn: "üç∞ Postre",
    platBtn: "üçΩÔ∏è Plato",
    sendBtn: "Enviar"
  },
  it: {
    title: "üë®‚Äçüç≥ Il tuo Chef Virtuale",
    subtitle: "Sono qui per immaginare con te ricette uniche e personalizzate. Entra nell‚Äôuniverso gourmet 2.0 dove tu sei il protagonista! ‚ú®",
    greeting: "Ciao üëã, sono Hugo, il tuo Chef Virtuale! Come posso deliziarti oggi? üòã",
    options: [
      "üçÖ Crea una ricetta con i miei ingredienti",
      "üç∞ Crea una ricetta secondo i miei desideri",
      "üéÅ Sorprendimi con una ricetta di stagione"
    ],
    askIngredients: "Dimmi gli ingredienti principali ü•ïüçóüç´ :",
    askType: "Vuoi un dessert üç∞ o un piatto üçΩÔ∏è?",
    askCustom: "Perfetto! Descrivimi il tuo desiderio (es: torta di mele, curry piccante‚Ä¶):",
    askPeople: "Per quante persone devo preparare questa delizia? üë®‚Äçüë©‚Äçüëß‚Äçüë¶",
    askDessert: "Perfetto üòç! Qual √® l‚Äôingrediente principale (cioccolato, frutta‚Ä¶)?",
    askPlat: "Ottimo! Preferisci carne ü•© o pesce üêü?",
    surprise: "‚ú® Ta-daa! Ecco un‚Äôidea di stagione solo per te‚Ä¶",
    dessertBtn: "üç∞ Dessert",
    platBtn: "üçΩÔ∏è Piatto",
    sendBtn: "Invia"
  },
  pt: {
    title: "üë®‚Äçüç≥ O Seu Chef Virtual",
    subtitle: "Estou aqui para imaginar consigo receitas √∫nicas e personalizadas. Entre no universo gourmet 2.0 onde VOC√ä √© o protagonista! ‚ú®",
    greeting: "Ol√° üëã, eu sou o Hugo, o seu Chef Virtual! Como posso delici√°-lo hoje? üòã",
    options: [
      "üçÖ Criar uma receita com os meus ingredientes",
      "üç∞ Criar uma receita de acordo com os meus desejos",
      "üéÅ Surpreenda-me com uma receita da esta√ß√£o"
    ],
    askIngredients: "Diga-me os ingredientes principais ü•ïüçóüç´ :",
    askType: "Prefere uma sobremesa üç∞ ou um prato üçΩÔ∏è?",
    askCustom: "Perfeito! Descreva o seu desejo (ex: tarte de ma√ß√£, caril picante‚Ä¶):",
    askPeople: "Para quantas pessoas devo preparar esta del√≠cia? üë®‚Äçüë©‚Äçüëß‚Äçüë¶",
    askDessert: "√ìtimo üòç! Qual √© o ingrediente principal (chocolate, fruta‚Ä¶)?",
    askPlat: "Maravilha! Prefere carne ü•© ou peixe üêü?",
    surprise: "‚ú® Tcharan! Aqui est√° uma ideia da esta√ß√£o s√≥ para voc√™‚Ä¶",
    dessertBtn: "üç∞ Sobremesa",
    platBtn: "üçΩÔ∏è Prato",
    sendBtn: "Enviar"
  },
  de: {
    title: "üë®‚Äçüç≥ Dein Virtueller Koch",
    subtitle: "Ich bin hier, um mit dir einzigartige und personalisierte Rezepte zu kreieren. Tritt ein in die Gourmet-Welt 2.0, in der DU der Star bist! ‚ú®",
    greeting: "Hallo üëã, ich bin Hugo, dein virtueller Koch! Wie darf ich dich heute verw√∂hnen? üòã",
    options: [
      "üçÖ Ein Rezept mit meinen Zutaten erstellen",
      "üç∞ Ein Rezept nach meinen W√ºnschen erstellen",
      "üéÅ √úberrasche mich mit einem saisonalen Rezept"
    ],
    askIngredients: "Nenne mir die Hauptzutaten ü•ïüçóüç´ :",
    askType: "M√∂chtest du ein Dessert üç∞ oder ein Hauptgericht üçΩÔ∏è?",
    askCustom: "Super! Beschreibe deinen Wunsch (z.B. Apfelkuchen, scharfes Curry‚Ä¶):",
    askPeople: "F√ºr wie viele Personen soll ich dieses Gericht zubereiten? üë®‚Äçüë©‚Äçüëß‚Äçüë¶",
    askDessert: "Perfekt üòç! Was ist die Hauptzutat (Schokolade, Obst‚Ä¶)?",
    askPlat: "Toll! Bevorzugst du Fleisch ü•© oder Fisch üêü?",
    surprise: "‚ú® Voil√†! Eine saisonale Idee nur f√ºr dich‚Ä¶",
    dessertBtn: "üç∞ Dessert",
    platBtn: "üçΩÔ∏è Hauptgericht",
    sendBtn: "Senden"
  }
};

// S√©lection du bon jeu de textes
const t = texts[currentLang] || texts['fr'];

// Variables pour stocker les r√©ponses
let userIngredients = "";
let userCustom = "";
let userPeople = "";

const chat = document.getElementById('chat');
const container = document.getElementById('assistantContainer');

// üî• Fonction mise √† jour du header
function updateHeader() {
  document.getElementById('title').innerText = t.title;
  document.getElementById('subtitle').innerText = t.subtitle;
}

function addMessage(text, type='bot'){
  const div = document.createElement('div');
  div.className = `message ${type}`;
  div.innerText = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

// üî• Champ de saisie stylis√© fa√ßon bulle de chat
function addInput(placeholder, callback){
  const wrapper = document.createElement('div');
  wrapper.className = "message user input-wrapper";

  const input = document.createElement('input');
  input.type = "text";
  input.placeholder = placeholder;
  input.className = "chat-input";

  const btn = document.createElement('button');
  btn.innerText = t.sendBtn;
  btn.className = "send-btn";

  btn.onclick = ()=>{
    if(input.value.trim()!==""){
      const val = input.value.trim();
      wrapper.remove();
      addMessage(val,'user');
      callback(val);
    }
  };

  wrapper.appendChild(input);
  wrapper.appendChild(btn);
  chat.appendChild(wrapper);
  chat.scrollTop = chat.scrollHeight;
  input.focus();
}

function addChoices(options){
  const div = document.createElement('div');
  div.className = 'choices';
  options.forEach(opt=>{
    const btn = document.createElement('button');
    btn.className = 'choice-btn';
    btn.innerText = opt;
    btn.onclick = ()=> handleChoice(opt);
    div.appendChild(btn);
  });
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function start(){
  updateHeader();
  addMessage(t.greeting);
  addChoices(t.options);
  container.classList.add('show');
}

function handleChoice(choice){
  addMessage(choice,'user');
  document.querySelectorAll('.choices').forEach(c=>c.remove());

  if(choice.includes("üçÖ") || choice.includes("ingredients") || choice.includes("ingredientes") || choice.includes("ingredienti") || choice.includes("Zutaten")){
    addMessage(t.askIngredients);
    addInput(t.askIngredients, (val)=>{
      userIngredients = val;
      addMessage(t.askPeople);
      addInput(t.askPeople,(val)=> userPeople = val);
    });

  } else if(choice.includes("üç∞") || choice.includes("cravings") || choice.includes("antojos") || choice.includes("desideri") || choice.includes("W√ºnschen")){
    addMessage(t.askType);
    addChoices([t.dessertBtn, t.platBtn]);

  } else if(choice.includes("üéÅ") || choice.includes("Surprise") || choice.includes("Sorpr√©ndeme") || choice.includes("Sorprendimi") || choice.includes("√úberrasche")){
    addMessage(t.surprise);

  } else if(choice.includes("Dessert") || choice.includes("Postre") || choice.includes("Dolce") || choice.includes("Dessert")){
    addMessage(t.askCustom);
    addInput(t.askCustom, (val)=>{
      userCustom = val;
      addMessage(t.askPeople);
      addInput(t.askPeople,(val)=> userPeople = val);
    });

  } else if(choice.includes("Plat") || choice.includes("Main Dish") || choice.includes("Plato") || choice.includes("Piatto") || choice.includes("Hauptgericht")){
    addMessage(t.askCustom);
    addInput(t.askCustom, (val)=>{
      userCustom = val;
      addMessage(t.askPeople);
      addInput(t.askPeople,(val)=> userPeople = val);
    });
  }
}

// üöÄ d√©marrage
start();
